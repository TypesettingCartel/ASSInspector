From 926da935d70fa778e13454cc4ad66c77f591ff48 Mon Sep 17 00:00:00 2001
From: torque <torque@users.noreply.github.com>
Date: Wed, 28 Mar 2018 23:37:43 -0700
Subject: [PATCH] Don't use approximation in rasterizer.

Fixes calculated boundaries off by a pixel or so in some cases.
---
 libass/ass_rasterizer.c | 4 +---
 1 file changed, 1 insertion(+), 3 deletions(-)

diff --git a/libass/ass_rasterizer.c b/libass/ass_rasterizer.c
index df11753..683955c 100644
--- a/libass/ass_rasterizer.c
+++ b/libass/ass_rasterizer.c
@@ -189,9 +189,7 @@ static bool add_line(RasterizerData *rst, ASS_Vector pt0, ASS_Vector pt1)
     line->a *= 1 << shift;
     line->b *= 1 << shift;
     line->c *= 1 << shift;
-    line->scale = (uint64_t) 0x53333333 * (uint32_t) (max_ab * (uint64_t) max_ab >> 32) >> 32;
-    line->scale += 0x8810624D - (0xBBC6A7EF * (uint64_t) max_ab >> 32);
-    //line->scale = ((uint64_t) 1 << 61) / max_ab;
+    line->scale = ((uint64_t) 1 << 61) / max_ab;
     return true;
 }
 
-- 
2.15.0

